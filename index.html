<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spades Arcade — Classic & 60-Second</title>
  <meta name="description" content="Play Spades in Classic mode or blaze through 60-Second Arcade rounds. Clean UI, smart AI, clear turn & trick indicators." />
  <style>
    :root{
      --ink:#0b1220;--felt:#0a5a2b;--paper:#f7fafc;
      --teamNS:#22c55e;--teamNS-ink:#062e18;
      --teamEW:#ec4899;--teamEW-ink:#3b0b1f;
      --glow1:#00e1ff;--glow2:#a855f7;--danger:#ff5a5a;
      --ok:#10b981;--muted:#5b6b8a;
    }
    html,body{height:100%;margin:0;background:var(--paper);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .hidden{display:none!important}
    /* Welcome */
    #welcome{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:24px;z-index:10;background:var(--paper)}
    .hero{width:min(960px,94vw);padding:48px;border-radius:28px;background:
      radial-gradient(1100px 680px at 5% 8%,#fff 0%,#eff9ff 38%,transparent 65%),
      radial-gradient(900px 600px at 90% 25%,#ffe8fb 0%,#e7f5ff 40%,transparent 70%),
      linear-gradient(180deg,#fff 0%,#f3f9fe 60%,#f0fff9 100%);
      border:1px solid rgba(14,18,40,.06);box-shadow:0 20px 60px rgba(14,18,40,.12)}
    .hero h1{margin:0 0 6px;font-size:2.6rem;letter-spacing:-.02em}
    .hero h2{margin:0 0 14px;font-weight:600;color:var(--muted)}
    .hero p{margin:0 auto 22px;max-width:640px;color:#233047}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    .btn{appearance:none;border:0;border-radius:18px;padding:12px 20px;font-weight:700;cursor:pointer;transition:transform .08s,box-shadow .08s}
    .btn:active{transform:translateY(1px)}
    .btn-primary{color:#fff;background:linear-gradient(90deg,var(--glow1),var(--glow2))}
    .btn-secondary{background:#e2e8f0;color:#111827}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:14px;background:#eef2ff;color:#1f2a44;font-size:.9rem}
    /* Table */
    #table{position:absolute;inset:0;background:var(--felt);display:flex;flex-direction:column;justify-content:space-between;padding:12px 12px 16px;box-sizing:border-box}
    /* HUD */
    #topbar{display:flex;align-items:center;justify-content:space-between;gap:8px}
    #modeSwitch{display:flex;gap:8px}
    #timer{padding:6px 12px;border-radius:16px;background:#fff;font-weight:800;box-shadow:0 2px 6px rgba(0,0,0,.2);display:none;min-width:92px;text-align:center}
    #timer.low{background:#ffe2e2}
    #status{margin:8px auto 0;display:flex;gap:8px;align-items:center;justify-content:center;flex-wrap:wrap}
    .status-pill{background:rgba(255,255,255,.92);border:1px solid rgba(0,0,0,.06);padding:6px 10px;border-radius:12px;font-weight:700}
    /* Scores */
    #scoreboard{display:flex;gap:8px}
    .score{min-width:120px;padding:8px 12px;border-radius:14px;font-weight:800}
    .score small{display:block;font-weight:600}
    .ns{background:var(--teamNS);color:var(--teamNS-ink)}
    .ew{background:var(--teamEW);color:var(--teamEW-ink)}
    /* Players */
    #players{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff}
    .row-others{width:100%;display:flex;justify-content:space-between;padding:0 18%}
    .plabel{display:flex;flex-direction:column;align-items:center;gap:2px;padding:8px 14px;margin-bottom:6px;min-width:108px;border-radius:14px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);}
    .plabel strong{font-size:1rem}
    .plabel span{font-size:.85rem}
    #north{background:rgba(34,197,94,.85);border-color:rgba(34,197,94,.95);color:var(--teamNS-ink)}
    #west,#east{background:rgba(236,72,153,.85);border-color:rgba(236,72,153,.95);color:var(--teamEW-ink)}
    .turn{box-shadow:0 0 12px 3px var(--glow1)}
    /* Trick area */
    #trick{height:130px;display:flex;align-items:center;justify-content:center;gap:28px;color:#fff}
    .played{display:flex;flex-direction:column;align-items:center;gap:4px}
    .seat{font-size:.75rem;font-weight:800}
    .mini{width:30px;height:42px;border-radius:5px;background:#fff;color:#111;border:1px solid #cbd5e1;display:flex;flex-direction:column;align-items:center;justify-content:center;font-weight:700}
    .mini .s{font-size:1.05rem}
    .mini.heart .s,.mini.diamond .s{color:#c62828}
    .mini.spade .s,.mini.club .s{color:#111}
    /* Hand */
    #hand{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:6px;padding:6px 8px}
    .card{width:60px;height:84px;border-radius:8px;border:1px solid #cbd5e1;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;font-weight:800;cursor:pointer;user-select:none;}
    .card .r{font-size:1.05rem}.card .s{font-size:1.5rem}
    .card.heart .s,.card.diamond .s{color:#c62828}.card.spade .s,.card.club .s{color:#111}
    .card.legal{box-shadow:0 0 0 2px var(--glow1)}
    .card.dim{opacity:.35;filter:grayscale(.2)}
    .shake{animation:shake .15s linear}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-3px)}50%{transform:translateX(3px)}75%{transform:translateX(-2px)}100%{transform:translateX(0)}}
    /* Toast + overlay */
    #toast{position:absolute;bottom:96px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,.95);color:#111;padding:8px 12px;border-radius:12px;font-weight:700;border:1px solid rgba(0,0,0,.08);opacity:0;transition:opacity .4s;}
    #overlay{position:fixed;inset:0;background:rgba(0,0,0,.72);color:#fff;display:none;align-items:center;justify-content:center;flex-direction:column;gap:12px;z-index:20;text-align:center;padding:20px}
    /* Trick history */
    #history{position:absolute;bottom:6px;left:6px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);border-radius:10px;color:#fff;padding:6px 8px;font-size:.9rem}
    #history b{font-weight:800}
  </style>
</head>
<body>
  <div id="welcome">
    <div class="hero">
      <h1>Spades Arcade</h1>
      <h2>Classic or 60-Second quick play</h2>
      <p>Choose Classic Spades for a full traditional round or blitz through a single 60-second deal where the most tricks wins. Clear turn prompts, suit guidance, and crisp visuals help you play fast and fair.</p>
      <div class="row" style="margin-bottom:10px">
        <button id="startClassic" class="btn btn-primary">Play Classic</button>
        <button id="startTimed" class="btn btn-secondary">Play 60-Second</button>
        <button id="how" class="btn">How to Play</button>
      </div>
      <div class="chip">Pro tip: follow the lead suit when you can. Spades trump other suits; Jokers off by default in this mode.</div>
    </div>
  </div>

  <div id="table" class="hidden">
    <div id="topbar">
      <div id="modeSwitch">
        <button id="toClassic" class="btn btn-secondary">Classic</button>
        <button id="toTimed" class="btn btn-secondary">60-Second</button>
      </div>
      <div id="status">
        <span id="turnPill" class="status-pill">Ready</span>
        <span id="leadPill" class="status-pill hidden">Lead: <b id="leadSuitTxt">—</b></span>
        <span id="spadePill" class="status-pill hidden">Spades Broken</span>
      </div>
      <div id="scoreboard">
        <div class="score ns"><small>North/South</small><span id="nsScore">Bid 0 · Tricks 0</span></div>
        <div class="score ew"><small>East/West</small><span id="ewScore">Bid 0 · Tricks 0</span></div>
      </div>
      <div id="timer">60s</div>
    </div>

    <div id="players">
      <div id="north" class="plabel"><strong>North</strong><span>Partner</span><span id="nCount">13 cards</span></div>
      <div class="row-others">
        <div id="west" class="plabel"><strong>West</strong><span>Opponent</span><span id="wCount">13 cards</span></div>
        <div id="east" class="plabel"><strong>East</strong><span>Opponent</span><span id="eCount">13 cards</span></div>
      </div>
      <div id="trick"></div>
    </div>

    <div id="hand"></div>
    <div id="history">Last tricks: <b id="histTxt">—</b></div>
    <div id="toast"></div>
  </div>

  <div id="overlay"></div>

  <script>
(() => {
  "use strict";
  const suits = ['♠','♣','♦','♥'];
  const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
  const seatNames = ['South','East','North','West'];
  let players = [];
  let current = 0;
  let leadSuit = null;
  let trick = [];
  let spadesBroken = false;
  let mode = 'classic';
  let lockPlay = false;
  let timerRef = null, timeLeft = 60;
  const lastTricks = [];
  const els = {
    welcome: document.getElementById('welcome'),
    table: document.getElementById('table'),
    startClassic: document.getElementById('startClassic'),
    startTimed: document.getElementById('startTimed'),
    how: document.getElementById('how'),
    toClassic: document.getElementById('toClassic'),
    toTimed: document.getElementById('toTimed'),
    timer: document.getElementById('timer'),
    turnPill: document.getElementById('turnPill'),
    leadPill: document.getElementById('leadPill'),
    leadSuitTxt: document.getElementById('leadSuitTxt'),
    spadePill: document.getElementById('spadePill'),
    nsScore: document.getElementById('nsScore'),
    ewScore: document.getElementById('ewScore'),
    nCount: document.getElementById('nCount'),
    eCount: document.getElementById('eCount'),
    wCount: document.getElementById('wCount'),
    north: document.getElementById('north'),
    east: document.getElementById('east'),
    west: document.getElementById('west'),
    trick: document.getElementById('trick'),
    hand: document.getElementById('hand'),
    toast: document.getElementById('toast'),
    overlay: document.getElementById('overlay'),
    histTxt: document.getElementById('histTxt'),
  };
  const show = (el) => el.classList.remove('hidden');
  const hide = (el) => el.classList.add('hidden');
  function buildDeck(){
    const d=[]; for(const s of suits){ for(const r of ranks){ d.push({suit:s,rank:r}); } } return d;
  }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
  const rIndex = r => ranks.indexOf(r);
  function cmpCards(a,b,lead){
    if(a.suit===b.suit) return rIndex(a.rank)-rIndex(b.rank);
    if(a.suit==='♠' && b.suit!=='♠') return 1;
    if(b.suit==='♠' && a.suit!=='♠') return -1;
    if(a.suit===lead) return 1;
    if(b.suit===lead) return -1;
    return 0;
  }
  function deal(){
    const deck = shuffle(buildDeck());
    players = Array.from({length:4},()=>({hand:[],tricks:0,bid:0}));
    for(let i=0;i<52;i++) players[i%4].hand.push(deck[i]);
    for(const p of players){
      p.hand.sort((a,b)=> (a.suit===b.suit? rIndex(a.rank)-rIndex(b.rank) : (['♣','♠','♥','♦'].indexOf(a.suit)-['♣','♠','♥','♦'].indexOf(b.suit))));
      p.bid = estimateBid(p.hand);
    }
  }
  function estimateBid(hand){
    let bid=0;
    for(const c of hand){
      const i=rIndex(c.rank);
      if(c.suit==='♠'){ if(i>=8) bid+=1; } else { if(i>=10) bid+=0.5; }
    }
    return Math.max(1, Math.round(bid));
  }
  function findFirst(){
    for(let i=0;i<4;i++){
      if(players[i].hand.some(c=>c.suit==='♣' && c.rank==='2')) return i;
    }
    return 0;
  }
  function renderScores(){
    const ns = players[0].tricks + players[2].tricks;
    const ew = players[1].tricks + players[3].tricks;
    const nsBid = players[0].bid + players[2].bid;
    const ewBid = players[1].bid + players[3].bid;
    els.nsScore.textContent = `Bid ${nsBid} · Tricks ${ns}`;
    els.ewScore.textContent = `Bid ${ewBid} · Tricks ${ew}`;
  }
  function renderCounts(){
    els.nCount.textContent = `${players[2].hand.length} cards`;
    els.eCount.textContent = `${players[1].hand.length} cards`;
    els.wCount.textContent = `${players[3].hand.length} cards`;
  }
  function setTurnPills(){
    els.north.classList.toggle('turn', current===2);
    els.east.classList.toggle('turn', current===1);
    els.west.classList.toggle('turn', current===3);
    const seat = seatNames[current];
    els.turnPill.textContent = (current===0) ? 'Your Turn' : `${seat} to play`;
    if(leadSuit){ els.leadSuitTxt.textContent = leadSuit; show(els.leadPill); } else { hide(els.leadPill); }
    if(spadesBroken) show(els.spadePill); else hide(els.spadePill);
  }
  function suitClass(s){ return s==='♥'?'heart':s==='♦'?'diamond':s==='♠'?'spade':'club'; }
  function patchTrick(){
    els.trick.innerHTML='';
    for(const play of trick){
      const wrap = document.createElement('div'); wrap.className='played';
      const seat = document.createElement('div'); seat.className='seat'; seat.textContent = seatNames[play.player][0];
      const mini = document.createElement('div'); mini.className = `mini ${suitClass(play.card.suit)}`;
      mini.innerHTML = `<div class="r">${play.card.rank}</div><div class="s">${play.card.suit}</div>`;
      wrap.appendChild(seat); wrap.appendChild(mini);
      els.trick.appendChild(wrap);
    }
  }
  function groupAndOrderHand(hand){
    const groups = {'♣':[], '♠':[], '♥':[], '♦':[]};
    hand.forEach((c,idx)=>groups[c.suit].push({c,idx}));
    for(const s in groups) groups[s].sort((a,b)=> rIndex(a.c.rank)-rIndex(b.c.rank));
    const blacks = ['♣','♠'].filter(s=>groups[s].length);
    const reds = ['♥','♦'].filter(s=>groups[s].length);
    const seq=[]; let nb=0,nr=0; let want = (blacks.length>=reds.length)?'b':'r';
    while(nb<blacks.length || nr<reds.length){
      if(want==='b' && nb<blacks.length){ seq.push(blacks[nb++]); want='r'; }
      else if(want==='r' && nr<reds.length){ seq.push(reds[nr++]); want='b'; }
      else { if(nb<blacks.length) seq.push(blacks[nb++]); if(nr<reds.length) seq.push(reds[nr++]); }
    }
    const ordered=[]; for(const s of seq) ordered.push(...groups[s]); return ordered;
  }
  function legalMovesOf(hand){
    if(current!==0) return [];
    if(!leadSuit){
      const onlySpades = hand.every(c=>c.suit==='♠');
      const res=[]; hand.forEach((c,i)=>{ if(onlySpades || spadesBroken || c.suit!=='♠') res.push(i); });
      return res.length?res:hand.map((_,i)=>i);
    }else{
      const has = hand.some(c=>c.suit===leadSuit);
      const res=[]; hand.forEach((c,i)=>{ if(!has || c.suit===leadSuit) res.push(i); });
      return res;
    }
  }
  function renderHand(){
    const south = players[0];
    const legals = legalMovesOf(south.hand);
    const ordered = groupAndOrderHand(south.hand);
    els.hand.innerHTML='';
    ordered.forEach(({c,idx})=>{
      const div = document.createElement('div');
      div.className = `card ${suitClass(c.suit)}`;
      div.innerHTML = `<div class="r">${c.rank}</div><div class="s">${c.suit}</div>`;
      const legal = legals.includes(idx);
      if(legal) div.classList.add('legal'); else div.classList.add('dim');
      div.addEventListener('click',()=>{
        if(lockPlay) return;
        if(!legal){ toast(`Must follow suit${leadSuit?`: ${leadSuit}`:''}`); div.classList.add('shake'); setTimeout(()=>div.classList.remove('shake'),160); return; }
        playCard(0, idx);
      });
      els.hand.appendChild(div);
    });
  }
  function toast(msg){
    els.toast.textContent = msg; els.toast.style.opacity='1';
    setTimeout(()=>{ els.toast.style.opacity='0'; }, 1600);
  }
  function playCard(pIdx, cardIdx){
    if(lockPlay) return;
    const p = players[pIdx];
    const card = p.hand.splice(cardIdx,1)[0];
    trick.push({card, player:pIdx});
    if(!leadSuit){ leadSuit = card.suit; if(card.suit==='♠') spadesBroken = true; }
    else if(card.suit==='♠'){ spadesBroken = true; }
    patchTrick(); renderCounts(); setTurnPills();
    current = (current+1) % 4;
    if(trick.length<4){
      if(current!==0) setTimeout(aiPlay, 220);
      renderHand();
    }else{
      lockPlay = true;
      setTimeout(resolveTrick, 340);
    }
  }
  function aiPlay(){
    if(lockPlay) return;
    const pIdx = current;
    const hand = players[pIdx].hand;
    let legal=[];
    if(!leadSuit){
      const onlySp = hand.every(c=>c.suit==='♠');
      legal = hand.map((c,i)=> (onlySp || spadesBroken || c.suit!=='♠') ? i : null).filter(i=>i!==null);
    }else{
      const has = hand.some(c=>c.suit===leadSuit);
      legal = hand.map((c,i)=> (!has || c.suit===leadSuit) ? i : null).filter(i=>i!==null);
    }
    if(legal.length===0) return;
    let pick = legal[0];
    for(const i of legal){
      const a=hand[i], b=hand[pick];
      if(a.suit!== '♠' && b.suit==='♠') pick=i;
      else if(a.suit===b.suit && rIndex(a.rank)<rIndex(b.rank)) pick=i;
    }
    playCard(pIdx, pick);
  }
  function resolveTrick(){
    let winner = trick[0];
    for(const play of trick.slice(1)){
      if(cmpCards(play.card, winner.card, leadSuit)>0) winner = play;
    }
    const wIdx = winner.player;
    players[wIdx].tricks++;
    const compact = trick.map(t=> `${seatNames[t.player][0]}:${t.card.rank}${t.card.suit}`).join(' ');
    lastTricks.unshift(`${compact} → ${seatNames[wIdx][0]}`);
    if(lastTricks.length>3) lastTricks.pop();
    els.histTxt.textContent = lastTricks.join('   |   ');
    trick = []; leadSuit = null; lockPlay=false;
    current = wIdx;
    renderScores(); patchTrick(); renderCounts(); setTurnPills(); renderHand();
    const southDone = players[0].hand.length===0;
    if(mode==='classic' && southDone){ endGame(); return; }
    if(current!==0) setTimeout(aiPlay, 320);
  }
  function endGame(){
    stopTimer(true);
    const nsT = players[0].tricks + players[2].tricks;
    const ewT = players[1].tricks + players[3].tricks;
    let nsScore, ewScore;
    if(mode==='classic'){
      const nsBid = players[0].bid + players[2].bid;
      const ewBid = players[1].bid + players[3].bid;
      nsScore = nsT>=nsBid ? nsBid*10 + (nsT-nsBid) : -nsBid*10;
      ewScore = ewT>=ewBid ? ewBid*10 + (ewT-ewBid) : -ewBid*10;
    }else{
      nsScore = nsT; ewScore = ewT;
    }
    const msg = nsScore===ewScore ? `It's a tie!` : (nsScore>ewScore ? `NS wins!` : `EW wins!`);
    els.overlay.innerHTML = `<div style="font-size:1.3rem;font-weight:800">${msg}</div>
      <div>NS ${nsScore} • EW ${ewScore}</div>
      <button id="again" class="btn btn-primary">Play Again</button>`;
    els.overlay.style.display='flex';
    document.getElementById('again').onclick = ()=>{ els.overlay.style.display='none'; start(mode); };
  }
  function startTimer(reset=true){
    stopTimer();
    if(reset) timeLeft = 60;
    els.timer.classList.toggle('low', timeLeft<=10);
    els.timer.style.display='block';
    els.timer.textContent = `${timeLeft}s`;
    timerRef = setInterval(()=>{
      timeLeft--;
      if(timeLeft<=10) els.timer.classList.add('low');
      els.timer.textContent = `${timeLeft}s`;
      if(timeLeft<=0){ stopTimer(); endGame(); }
    },1000);
  }
  function stopTimer(hide=false){
    if(timerRef){ clearInterval(timerRef); timerRef=null; }
    if(hide) els.timer.style.display='none';
  }
  document.addEventListener('visibilitychange',()=>{
    if(mode!=='timed') return;
    if(document.hidden){ stopTimer(); }
    else if(!timerRef && timeLeft>0){ startTimer(false); }
  });
  function start(selected){
    els.overlay.style.display='none';
    mode = selected;
    spadesBroken=false; leadSuit=null; trick.length=0; lastTricks.length=0;
    deal();
    current = findFirst();
    players.forEach(p=>p.tricks=0);
    els.welcome.classList.add('hidden');
    els.table.classList.remove('hidden');
    renderCounts(); renderScores(); patchTrick(); setTurnPills(); renderHand();
    if(mode==='timed') startTimer(true); else stopTimer(true);
    if(current!==0) setTimeout(aiPlay, 350);
  }
  els.startClassic.onclick = ()=> start('classic');
  els.startTimed.onclick   = ()=> start('timed');
  els.toClassic.onclick = ()=> start('classic');
  els.toTimed.onclick   = ()=> start('timed');
  els.how.onclick = ()=> {
    alert(
`How to Play (Quick)
• Follow the lead suit if you can. If not, you may play any card.
• Spades trump other suits. You cannot lead spades until spades are broken.
• In 60-Second mode: most tricks (books) after 60s wins.
• Classic mode: traditional bidding & scoring lite (team bids shown; tricks still decide round outcome here).`);
  };
})();
  </script>
</body>
</html>

Fix HTML structure and remove duplicate tags.
